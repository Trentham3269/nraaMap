<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      .info {
  				padding: 6px 8px;
  				font: 14px/16px Arial, Helvetica, sans-serif;
  				background: white;
  				background: rgba(255,255,255,0.8);
  				box-shadow: 0 0 15px rgba(0,0,0,0.2);
  				border-radius: 5px;
      }
    </style>
    <meta charset="utf-8">
    <!-- Should override IE compatibility mode -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- Fit to device -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Does the intranet search index pages? if so consider content -->
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Tab Title -->
    <title>NRAA Ranges</title>

    <!-- Leaflet CSS -->
    <link href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" rel="stylesheet"/>

    <!-- leaflet-zoom-min CSS -->
    <!-- https://github.com/alanshaw/leaflet-zoom-min.git -->
    <link href="L.Control.ZoomMin.css", rel="stylesheet", media="screen"/>

    <!-- jQuery JS -->
    <!-- https://code.jquery.com/ -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>

    <!-- leaflet-zoom-min JS -->
    <!-- https://github.com/alanshaw/leaflet-zoom-min.git -->
    <script src="L.Control.ZoomMin.js"></script>

    <!-- Load ranges data from external .js file -->
    <script src="ranges.js"></script>
  </head>
  <body>
    <!-- Div for map -->
    <div id='map' style="height: 800px">

    <!-- Data and Map -->
    <script>
        // map
        var map = L.map('map', {
          center: [-27.833, 133.583],
          zoom: 4,
          minZoom: 5,
          maxZoom: 16,
          zoomControl: false
        });

        // add tiles and attribution to map
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);

        var markers = new L.FeatureGroup();

        // initialise map control - default position is topright
        var info = L.control();

        // create control's DOM elements
        info.onAdd = function (map) {
          this._div = L.DomUtil.create('div', 'info');
          this.update()
          return this._div;
        };

        // information to be displayed
        info.update = function (props) {
          this._div.innerHTML = '<div id="selState">' +
                                  '<input type="radio" name="state" id="state_ALL" value="ALL"> ALL<br>' +
                                  '<input type="radio" name="state" id="state_ACT" value="ACT"> ACT<br>' +
                                  '<input type="radio" name="state" id="state_NSW" value="NSW"> NSW<br>' +
                                  '<input type="radio" name="state" id="state_NT"  value="NT"> NT<br>'   +
                                  '<input type="radio" name="state" id="state_QLD" value="QLD"> QLD<br>' +
                                  '<input type="radio" name="state" id="state_SA"  value="SA"> SA<br>'   +
                                  '<input type="radio" name="state" id="state_TAS" value="TAS"> TAS<br>' +
                                  '<input type="radio" name="state" id="state_VIC" value="VIC"> VIC<br>' +
                                  '<input type="radio" name="state" id="state_WA"  value="WA"> WA<br>'   +
                                '</div>'
        };

        // add the info to the map
        info.addTo(map);

        // print full data array to console to confirm expected behaviour
        console.log(ranges);

        // zoom control for leaflet-zoom-min
        map.addControl(new L.Control.ZoomMin(''))

        // assign radio button selection to variable
        $("#selState").on("click", function() {

          var rangesState = $("input[type='radio'][name='state']:checked").val();

          console.log(rangesState);

          // subset data based on user selection
          var rangesSubset;
          if (rangesState === "ALL"){
            rangesSubset = ranges;
          } else {
            rangesSubset = ranges.filter(function (p) {
              return p.State === rangesState;
            });
          }

          console.log(rangesSubset);

          // add markers for each data point
      		for (var i = 0; i < rangesSubset.length; i++) {

      		    // popup content
      		    var popup = "<b>Range:</b> " + rangesSubset[i].Range + "<br>"
      						+ "<b>Type:</b> " + rangesSubset[i].Type + "<br>"
      						+ "<b>Maximum Distance:</b> " + rangesSubset[i].Max_Distance + "<br>"
      						+ "<b>No. of Targets:</b> " + rangesSubset[i].Targets + "<br>"
      						+ "<b>Electronic Targets:</b> " + rangesSubset[i].Electronic + "<br>"
      						+ "<b>Electronic System:</b> " + rangesSubset[i].ET_System + "<br>"
      						+ "<b>Clubs:</b> " + rangesSubset[i].Clubs

              marker = new L.marker([rangesSubset[i].Lat,rangesSubset[i].Long])
      					.bindPopup(popup)
      					.addTo(map)
      					.on('click', function (e) {
      						map.setView(e.latlng, 13);}
                /*.on('mouseover', function (e) {
        	        this.openPopup();}*/

      			)};

            markers.addLayer(marker);

            map.addLayer(markers);

        });
    </script>
  </body>
</html>
