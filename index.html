<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- Should override IE compatibility mode -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- Fit to device -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Does the intranet search index pages? if so consider content -->
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Tab Title -->
    <title>NRAA Ranges</title>

    <!-- Leaflet CSS -->
    <link href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" rel="stylesheet"/>

    <!-- leaflet-zoom-min CSS -->
    <!-- https://github.com/alanshaw/leaflet-zoom-min.git -->
    <link href="L.Control.ZoomMin.css", rel="stylesheet", media="screen"/>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>

    <!-- leaflet-zoom-min JS -->
    <!-- https://github.com/alanshaw/leaflet-zoom-min.git -->
    <script src="L.Control.ZoomMin.js"></script>

    <!-- Load ranges data from external .js file -->
    <script src="ranges.js"></script>
  </head>
  <body>
    <!-- Div for radio buttons -->
    <div id='selState'>
      <input type="radio" name="state" id="state_ALL" value="ALL" checked> ALL<br>
      <input type="radio" name="state" id="state_ACT" value="ACT"> ACT<br>
      <input type="radio" name="state" id="state_NSW" value="NSW"> NSW<br>
      <input type="radio" name="state" id="state_NT"  value="NT"> NT<br>
      <input type="radio" name="state" id="state_QLD" value="QLD"> QLD<br>
      <input type="radio" name="state" id="state_SA"  value="SA"> SA<br>
      <input type="radio" name="state" id="state_TAS" value="TAS"> TAS<br>
      <input type="radio" name="state" id="state_VIC" value="VIC"> VIC<br>
      <input type="radio" name="state" id="state_WA"  value="WA"> WA<br>
    </div>

    <!-- Div for map -->
    <div id='map' style="height: 800px">

    <!-- Data and Map -->
    <script>
      // Print full array to console
      console.log(ranges);

      // Assign radio button selection to variable
      var rangesSubset;
        if (document.getElementById("state_ALL").checked) {
          rangesSubset = ranges;
        } else if (document.getElementById("state_ACT").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "ACT";
          });
        } else if (document.getElementById("state_NSW").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "NSW";
          });
        } else if (document.getElementById("state_NT").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "NT";
          });
        } else if (document.getElementById("state_QLD").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "QLD";
          });
        } else if (document.getElementById("state_SA").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "SA";
          });
        } else if (document.getElementById("state_TAS").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "TAS";
          });
        } else if (document.getElementById("state_VIC").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "VIC";
          });
        } else if (document.getElementById("state_WA").checked) {
          rangesSubset = ranges.filter(function (p) {
            return p.State === "WA";
          });
        }

      console.log(rangesSubset);

        // map
        var map = L.map('map', {
          center: [-27.833, 133.583],
          zoom: 4,
          minZoom: 5,
          maxZoom: 16,
          zoomControl: false
        });

        // add tiles and attribution
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);

        // zoom control for leaflet-zoom-min
        map.addControl(new L.Control.ZoomMin(''))

    		// add markers for each data point
    		for (var i = 0; i < rangesSubset.length; i++) {

    		    // popup content
    		    var popup = "<b>Range:</b> " + rangesSubset[i].Range + "<br>"
    						+ "<b>Type:</b> " + rangesSubset[i].Type + "<br>"
    						+ "<b>Maximum Distance:</b> " + rangesSubset[i].Max_Distance + "<br>"
    						+ "<b>No. of Targets:</b> " + rangesSubset[i].Targets + "<br>"
    						+ "<b>Electronic Targets:</b> " + rangesSubset[i].Electronic + "<br>"
    						+ "<b>Electronic System:</b> " + rangesSubset[i].ET_System + "<br>"
    						+ "<b>Clubs:</b> " + rangesSubset[i].Clubs

            // add popups
    				marker = new L.marker([rangesSubset[i].Lat,rangesSubset[i].Long])
    					.bindPopup(popup)
    					.addTo(map)
    					.on('click', function (e) {
    						map.setView(e.latlng, 13);}
              /*.on('mouseover', function (e) {
      	        this.openPopup();}*/
    			)};
    </script>
  </body>
</html>
